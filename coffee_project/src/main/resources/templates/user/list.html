<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Danh Sách Nhân Viên</title>
    <style th:replace="/layout::style"></style>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" th:href="@{/bootstrap-5.0.2-dist/css/bootstrap.css}"
          href="../static/bootstrap-5.0.2-dist/css/bootstrap.css">
    <script src="/js/jquery-3.7.0.min.js"></script>
    <link rel="shortcut icon" href="/static/android-chrome-512x512.png" th:href="@{/android-chrome-512x512.png}">
    <style>
        .modal-backdrop {
            z-index: 1040 !important;
        }
    </style>

</head>
<body>
<div class="container-fluid">

    <div class="row">
        <div th:replace="layout::side-bar">
        </div>
        <div class="col-10  col-sm-9 col-md-9 col-lg-10">
            <div th:replace="layout::nav-bar">
            </div>
            <div class="row min-vh-100 content">
                <div class="col-12">

                    <!-----------------------//CODE------------------------------------------------------------>
                    <h1 style="text-align: center; margin-bottom: 20px;margin-top: 2rem">Quản Lý Nhân Viên</h1>

                    <div class="justify-content-center" style="margin-bottom: 20px">

                        <div class="row">
                            <div class="col-1">

                                <a style="text-decoration: none" href="/order/">
                                    <button title="Quay lại"
                                            class="btn btn-primary">
                                        <i class="fa-solid fa-circle-arrow-left"></i></button>
                                </a>

                            </div>

                            <div class="col-4">
                            </div>
                            <div class="col-7">
                                <form th:action="@{/user/list}" th:method="get">
                                    <div class="d-flex justify-content-end">

                                        <div class="form-outline" style="margin-right: 0.6rem">
                                            <input id="search-input" name="search" type="search"
                                                   placeholder="Tên nhân viên"
                                                   class="form-control" th:value="${search}"/>
                                        </div>
                                        <button title="Tìm kiếm" type="submit"
                                                class="btn btn-primary">
                                            <i class="fas fa-search"></i>
                                        </button>

                                    </div>
                                </form>
                            </div>

                        </div>

                        <div class="table-responsive" style="margin-top: 20px">
                            <table class="table table-hover">
                                <thead>
                                <th scope="col">STT</th>
                                <th scope="col">Tên</th>
                                <th scope="col">Giới tính</th>
                                <th scope="col">Tài khoản</th>
                                <th scope="col">Lương</th>
                                <th scope="col">Vị trí</th>
                                <th colspan="3" scope="col" style="text-align: center">Chức năng</th>

                                </thead>
                                <tr th:each="user, status :${userPage}">
                                    <th th:text="${status.count}">
                                    <td th:text="${user.userName}">
                                    <td>
                                        <div th:if="${user.userGender == null}">Khác</div>
                                        <div th:if="${user.userGender}">Nam</div>
                                        <div th:if="${!user.userGender}">Nữ</div>
                                    </td>
                                    <td th:text="${user.account.accountName}">
                                    <td th:text="${#numbers.formatDecimal(user.userSalary, 0, 'COMMA', 0, 'POINT') + ' VND'}"></td>
                                    <td th:text="${user.employeeType.employeeTypeName}">
                                    <td style="text-align: center">

                                        <a th:href="@{/user/change-form/{id}(id=${user.userId})}">
                                            <button title="Sửa lương và ca làm việc" type="button"
                                                    class="btn btn-primary">
                                                <i class="fa-solid fa-pen-to-square"></i>
                                            </button>
                                        </a>
                                    </td>
                                    <td style="text-align: center">

                                        <!-- Button trigger detail modal -->
                                        <button title="Chi tiết" type="button" class="btn btn-primary"
                                                data-bs-toggle="modal"
                                                data-bs-target="#exampleModal1"
                                                th:attr="onclick=|showDetail(${user.userId})|">
                                            <i class="fa-solid fa-circle-info"></i>
                                        </button>
                                    </td>
                                    <td style="text-align: center">
                                        <button title="Xoá" style="text-align: center" type="button"
                                                class="btn btn-danger"
                                                data-bs-toggle="modal"
                                                data-bs-target="#exampleModal"
                                                th:attr="onclick=|showInfo(${user.userId},'${user.userName}')|">
                                            <i class="fa-regular fa-trash-can"></i>
                                        </button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <!---------------------------Paging--------------------------------------------------------------->
                        <div th:if="${userPage.totalPages >1}">
                            <div class="d-flex justify-content-center">
                                <nav aria-label="Page navigation example">
                                    <ul class="pagination">
                                        <li th:class="${!userPage.hasPrevious()} ? 'page-item disabled' : 'page-item'">
                                            <a
                                                    class="page-link"
                                                    th:href="@{/user/list/(page=${userPage.number -1},search=${search})}">Trước</a>
                                        </li>

                                        <li class="page-link disabled"><span
                                                th:text="${userPage.number +1}"></span>/<span
                                                th:text="${userPage.totalPages}"></span>
                                        </li>

                                        <li th:class="${!userPage.hasNext()} ? 'page-item disabled' : 'page-item'"><a
                                                class="page-link"
                                                th:href="@{/user/list/(page=${userPage.number +1},search=${search})}">Sau</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                        <!------------------------End Paging------------------------------------------------------------>
                    </div>

                    <!------------------END CODE------------------------------------------------------------------------->


                </div>
            </div>
            <div th:replace="layout::footer">
            </div>
        </div>
    </div>
</div>


<!-------------------------Toast-------------------------------------------------------------->
<div class="position-fixed bottom-0 end-0 p-3">
    <div id="liveToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong class="me-auto">Tin nhắn</strong>
            <small>Bây giờ</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body text-info" th:text="${msg}">
        </div>
    </div>
</div>
<!-------------------------End Toast-------------------------------------------------------------->


<!-- Button trigger modal -->

<!-- Modal Delete-->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/user/delete" method="post">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel"><strong>Xoá nhân viên</strong></h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input id="userId" hidden="hidden" name="userId">
                    <input name="userName" id="userName" hidden="hidden">
                    <div>Bạn có xác nhận xoá người dùng có tên là: <span id="userNameDisplay"></span>?</div>
                    <div style="color: red"><strong>Lưu ý:</strong> không thể hoàn tác hành động này!</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Thoát</button>
                    <button type="submit" class="btn btn-primary">Xác nhận</button>
                </div>
            </form>
        </div>
    </div>
</div>


<!-------Modal Detail---------------------------------->

<!-- Modal -->
<div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="d-flex justify-content-center modal-title fs-5" id="exampleModalLabel1">
                    <strong>Thông tin chi tiết</strong></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-5">
                        <div id="dnd" class="preview d-flex justify-content-center" style="margin-top: 15px">
                            <img id="imgPath" style="height: 150px; width: 100px;">
                        </div>
                    </div>
                    <div class="col-7">

                        <div><strong>Tên:</strong> <span id="userNameDetail"></span></div>

                        <div><strong>Giới tính:</strong> <span id="userGender"></span></div>

                        <div><strong>Ngày Sinh:</strong> <span id="userBirthday"></span></div>

                        <div><strong>Điện thoại:</strong> <span id="userPhoneNumber"></span></div>

                        <div><strong>Email:</strong> <span id="userEmail"></span></div>

                        <div><strong>Căn cước:</strong> <span id="userIdCard"></span></div>

                        <div><strong>Lương:</strong> <span id="userSalary"></span></div>

                        <div><strong>Địa chỉ:</strong> <span id="userAddress"></span></div>

                        <div><strong>Ca làm việc:</strong> <span id="employeeTypeName"></span></div>

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Thoát</button>
            </div>
        </div>
    </div>
</div>


<!-------End Modal Detail---------------------------------->


<script>
    //User Detail
    function showDetail(id) {
        $.ajax({
            contentType: "application/json",
            method: "GET",
            dataType: "json",
            url: "http://localhost:8080/api/user/detail/" + id,
            success: function (data) {
                let gender = "";
                if (data.userGender) {
                    gender = "Nam";
                } else {
                    gender = "Nữ";
                }
                let birthday = data.userBirthday.split("-").reverse().join("-");

                $("#userNameDetail").text(data.userName);
                $("#userGender").text(gender);
                $("#userBirthday").text(birthday);
                $("#userPhoneNumber").text(data.userPhoneNumber);
                $("#userEmail").text(data.userEmail);
                $("#userIdCard").text(data.userIdCard);
                $("#userSalary").text(data.userSalary.toLocaleString('en-US') + " VND");
                $("#userAddress").text(data.userAddress);
                $("#employeeTypeName").text(data.employeeType.employeeTypeName);
                $("#imgPath").attr("src", data.userImagePath);
                $("#exampleModal1").show();
            }
        })
    }

    //Show Delete Modal
    function showInfo(id, name) {
        document.getElementById("userId").value = id;
        document.getElementById("userName").value = name;
        document.getElementById("userNameDisplay").innerText = name
    }

</script>

<!--    //Toast Delete Successfully-->
<script th:if="${msg}">
    window.onload = function () {
        let myAlert = document.getElementById('liveToast');//select id of toast
        let bsAlert = new bootstrap.Toast(myAlert);//inizialize it
        bsAlert.show();//show it
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
<script th:src="@{/bootstrap-5.0.2-dist/js/bootstrap.bundle.js}"
        src="../static/bootstrap-5.0.2-dist/js/bootstrap.bundle.js"></script>

</body>
</html>